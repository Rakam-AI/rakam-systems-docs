"use strict";(self.webpackChunkrakam_systems_docs_portal=self.webpackChunkrakam_systems_docs_portal||[]).push([[3385],{4991(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tools/s3-utils","title":"S3 Component","description":"Lightweight Pythonic wrapper for S3 operations in rakam-system-tools","source":"@site/docs/tools/s3-utils.md","sourceDirName":"tools","slug":"/tools/s3-utils","permalink":"/rakam-systems-docs/tools/s3-utils","draft":false,"unlisted":false,"editUrl":"https://github.com/Rakam-AI/rakam_systems/edit/main/docs/docs/tools/s3-utils.md","tags":[],"version":"current","lastUpdatedBy":"Mohamed Bashar Touil","lastUpdatedAt":1771281692000,"frontMatter":{"title":"S3 Component","description":"Lightweight Pythonic wrapper for S3 operations in rakam-system-tools"},"sidebar":"docsSidebar","previous":{"title":"Rakam Eval SDK Documentation","permalink":"/rakam-systems-docs/tools/evaluation"},"next":{"title":"CLI","permalink":"/rakam-systems-docs/cli/"}}');var t=s(4848),r=s(8453);const l={title:"S3 Component",description:"Lightweight Pythonic wrapper for S3 operations in rakam-system-tools"},o="S3 Component",c={},d=[{value:"Features",id:"features",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Provider-Specific Endpoints",id:"provider-specific-endpoints",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"Basic Usage Example",id:"basic-usage-example",level:2},{value:"Full Example (Run from Repo)",id:"full-example-run-from-repo",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"File Operations",id:"file-operations",level:3},{value:"<code>upload_file(key, content, bucket=None, content_type=&quot;text/plain&quot;, metadata=None)</code>",id:"upload_filekey-content-bucketnone-content_typetextplain-metadatanone",level:4},{value:"<code>download_file(key, bucket=None, as_bytes=False)</code>",id:"download_filekey-bucketnone-as_bytesfalse",level:4},{value:"<code>delete_file(key, bucket=None)</code>",id:"delete_filekey-bucketnone",level:4},{value:"<code>file_exists(key, bucket=None)</code>",id:"file_existskey-bucketnone",level:4},{value:"<code>list_files(prefix=&quot;&quot;, bucket=None, max_keys=1000)</code>",id:"list_filesprefix-bucketnone-max_keys1000",level:4},{value:"<code>get_file_metadata(key, bucket=None)</code>",id:"get_file_metadatakey-bucketnone",level:4},{value:"Bucket Operations",id:"bucket-operations",level:3},{value:"<code>create_bucket(bucket=None)</code>",id:"create_bucketbucketnone",level:4},{value:"<code>bucket_exists(bucket=None)</code>",id:"bucket_existsbucketnone",level:4},{value:"<code>list_buckets()</code>",id:"list_buckets",level:4},{value:"Client Management",id:"client-management",level:3},{value:"<code>get_client()</code>",id:"get_client",level:4},{value:"<code>reset_client()</code>",id:"reset_client",level:4},{value:"<code>get_config()</code>",id:"get_config",level:4},{value:"Exception Handling",id:"exception-handling",level:2},{value:"Exception Hierarchy",id:"exception-hierarchy",level:3},{value:"Advanced Examples",id:"advanced-examples",level:2},{value:"Working with Binary Files",id:"working-with-binary-files",level:3},{value:"Using Custom Metadata",id:"using-custom-metadata",level:3},{value:"Batch Operations",id:"batch-operations",level:3},{value:"Working with Different Buckets",id:"working-with-different-buckets",level:3},{value:"Testing",id:"testing",level:2},{value:"Comparison with Original Script",id:"comparison-with-original-script",level:2},{value:"Original Script (boto3 direct usage)",id:"original-script-boto3-direct-usage",level:3},{value:"RS Component Style (clean and simple)",id:"rs-component-style-clean-and-simple",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Configuration Errors",id:"configuration-errors",level:3},{value:"Connection Errors",id:"connection-errors",level:3},{value:"Permission Errors",id:"permission-errors",level:3},{value:"Bucket Name Errors",id:"bucket-name-errors",level:3},{value:"Contributing",id:"contributing",level:2},{value:"License",id:"license",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"s3-component",children:"S3 Component"})}),"\n",(0,t.jsx)(n.p,{children:"The S3 component provides a lightweight, Pythonic wrapper around boto3 for S3 operations, following the Rakam Systems (RS) component pattern."}),"\n",(0,t.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Simple API"}),": Clean, intuitive functions for common S3 operations"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Environment-based Configuration"}),": No hardcoded credentials"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"S3-Compatible Services"}),": Works with AWS S3, OVH, Scaleway, MinIO, etc."]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Proper Error Handling"}),": Custom exceptions for different error cases"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Singleton Client"}),": Efficient connection reuse"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Type Hints"}),": Full type annotations for better IDE support"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"RS Component Style"}),": Consistent with other rakam_system_core utilities"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsxs)(n.p,{children:["Install ",(0,t.jsx)(n.strong,{children:"rakam-system-tools"})," (rs_core). The S3 component is included and pulls in boto3 as a dependency:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pip install rakam-system-tools\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or from the repo (development/editable):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# From the repository root\npip install -e rakam-system-tools/\n# or with uv\nuv pip install -e rakam-system-tools/\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Or add to your ",(0,t.jsx)(n.code,{children:"requirements.txt"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"rakam-system-tools>=0.1.2\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Set these environment variables (e.g., in your ",(0,t.jsx)(n.code,{children:".env"})," file):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Required\nS3_ACCESS_KEY=your_access_key_here\nS3_SECRET_KEY=your_secret_key_here\nS3_BUCKET_NAME=your-bucket-name\n\n# Optional (for S3-compatible services like OVH, Scaleway, MinIO)\nS3_ENDPOINT_URL=https://s3.gra.io.cloud.ovh.net\nS3_REGION=gra\n"})}),"\n",(0,t.jsx)(n.h3,{id:"provider-specific-endpoints",children:"Provider-Specific Endpoints"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"OVH Object Storage:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"S3_ENDPOINT_URL=https://s3.gra.io.cloud.ovh.net  # Gravelines\nS3_REGION=gra\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Scaleway Object Storage:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"S3_ENDPOINT_URL=https://s3.fr-par.scw.cloud\nS3_REGION=fr-par\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"MinIO (self-hosted):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"S3_ENDPOINT_URL=http://localhost:9000\nS3_REGION=us-east-1\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"AWS S3 (default):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# No endpoint URL needed for AWS\nS3_REGION=us-east-1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsxs)(n.p,{children:["After installing ",(0,t.jsx)(n.code,{children:"rakam-system-tools"})," and setting the required env vars (see ",(0,t.jsx)(n.a,{href:"#configuration",children:"Configuration"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from rakam_systems_tools.utils import s3\n\n# Upload a file\ns3.upload_file(\n    key="documents/report.txt",\n    content="Hello World!",\n    content_type="text/plain"\n)\n\n# Download a file (returns bytes; decode for text)\ncontent = s3.download_file("documents/report.txt")\nprint(content.decode("utf-8"))  # "Hello World!"\n\n# Check if file exists\nif s3.file_exists("documents/report.txt"):\n    print("File exists!")\n\n# List files with prefix\nfiles = s3.list_files(prefix="documents/")\nfor file in files:\n    print(f"{file[\'Key\']} - {file[\'Size\']} bytes")\n\n# Delete a file\ns3.delete_file("documents/report.txt")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"basic-usage-example",children:"Basic Usage Example"}),"\n",(0,t.jsxs)(n.p,{children:["Minimal script you can run locally (set ",(0,t.jsx)(n.code,{children:"S3_ACCESS_KEY"}),", ",(0,t.jsx)(n.code,{children:"S3_SECRET_KEY"}),", ",(0,t.jsx)(n.code,{children:"S3_BUCKET_NAME"})," in ",(0,t.jsx)(n.code,{children:".env"})," or environment):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# quick_s3_example.py\nfrom rakam_systems_tools.utils import s3\nfrom rakam_systems_tools.utils.s3 import S3Error, S3ConfigError\n\ntry:\n    # Ensure bucket is reachable\n    if not s3.bucket_exists():\n        raise SystemExit("Bucket not found or not accessible. Check env vars.")\n\n    # Upload\n    s3.upload_file("demo/hello.txt", "Hello from rs_core!", content_type="text/plain")\n    print("Uploaded demo/hello.txt")\n\n    # Download\n    data = s3.download_file("demo/hello.txt")\n    print("Downloaded:", data.decode("utf-8"))\n\n    # List\n    for f in s3.list_files(prefix="demo/"):\n        print(f"  {f[\'Key\']} ({f[\'Size\']} bytes)")\n\n    # Delete\n    s3.delete_file("demo/hello.txt")\n    print("Deleted demo/hello.txt")\nexcept S3ConfigError as e:\n    print("Config error:", e)\nexcept S3Error as e:\n    print("S3 error:", e)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"full-example-run-from-repo",children:"Full Example (Run from Repo)"}),"\n",(0,t.jsx)(n.p,{children:"A full runnable example that demonstrates upload, download, list, metadata, bucket ops, and error handling lives in the repo:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# From repository root; ensure .env has S3_ACCESS_KEY, S3_SECRET_KEY, S3_BUCKET_NAME\npython examples/s3_examples/s3_operations_example.py\n"})}),"\n",(0,t.jsx)(n.p,{children:"Clean up test objects created by that example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python examples/s3_examples/s3_operations_example.py --cleanup\n"})}),"\n",(0,t.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,t.jsx)(n.h3,{id:"file-operations",children:"File Operations"}),"\n",(0,t.jsx)(n.h4,{id:"upload_filekey-content-bucketnone-content_typetextplain-metadatanone",children:(0,t.jsx)(n.code,{children:'upload_file(key, content, bucket=None, content_type="text/plain", metadata=None)'})}),"\n",(0,t.jsx)(n.p,{children:"Upload a file to S3."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," (str): The S3 object key (path/filename)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"content"})," (str | bytes): File content"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name (defaults to ",(0,t.jsx)(n.code,{children:"S3_BUCKET_NAME"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"content_type"}),' (str): MIME type (default: "text/plain")']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"metadata"})," (dict, optional): Custom metadata dictionary"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"bool"})," - True if successful"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Raises:"})," ",(0,t.jsx)(n.code,{children:"S3Error"})," if upload fails"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'s3.upload_file(\n    key="data/config.json",\n    content=\'{"setting": "value"}\',\n    content_type="application/json",\n    metadata={"version": "1.0"}\n)\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"download_filekey-bucketnone-as_bytesfalse",children:(0,t.jsx)(n.code,{children:"download_file(key, bucket=None, as_bytes=False)"})}),"\n",(0,t.jsx)(n.p,{children:"Download a file from S3."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," (str): The S3 object key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"as_bytes"})," (bool): Return bytes instead of string (default: False)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"str | bytes"})," - File content"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Raises:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3NotFoundError"})," if file doesn't exist"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3Error"})," if download fails"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Download as string (decode bytes for text)\ntext = s3.download_file("data/config.json").decode("utf-8")\n\n# Download as bytes (for binary files)\nimage_data = s3.download_file("images/photo.jpg", as_bytes=True)\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"delete_filekey-bucketnone",children:(0,t.jsx)(n.code,{children:"delete_file(key, bucket=None)"})}),"\n",(0,t.jsx)(n.p,{children:"Delete a file from S3."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," (str): The S3 object key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"bool"})," - True if successful"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Raises:"})," ",(0,t.jsx)(n.code,{children:"S3Error"})," if deletion fails"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"file_existskey-bucketnone",children:(0,t.jsx)(n.code,{children:"file_exists(key, bucket=None)"})}),"\n",(0,t.jsx)(n.p,{children:"Check if a file exists in S3."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," (str): The S3 object key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"bool"})," - True if file exists"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Raises:"})," ",(0,t.jsx)(n.code,{children:"S3Error"}),' on errors other than "not found"']}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"list_filesprefix-bucketnone-max_keys1000",children:(0,t.jsx)(n.code,{children:'list_files(prefix="", bucket=None, max_keys=1000)'})}),"\n",(0,t.jsx)(n.p,{children:"List files in S3 bucket with optional prefix filter."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"prefix"})," (str): Filter to keys starting with this prefix"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"max_keys"})," (int): Maximum number of keys to return (default: 1000)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"List[Dict]"})," - List of file metadata dictionaries"]}),"\n",(0,t.jsx)(n.p,{children:"Each dictionary contains:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Key"})," (str): Object key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Size"})," (int): File size in bytes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"LastModified"})," (datetime): Last modification time"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ETag"})," (str): Entity tag"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# List all files in a folder\nfiles = s3.list_files(prefix=\"documents/2024/\")\nfor file in files:\n    print(f\"{file['Key']}: {file['Size']} bytes\")\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"get_file_metadatakey-bucketnone",children:(0,t.jsx)(n.code,{children:"get_file_metadata(key, bucket=None)"})}),"\n",(0,t.jsx)(n.p,{children:"Get metadata for a file without downloading it."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," (str): The S3 object key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"Dict"})," - Metadata dictionary"]}),"\n",(0,t.jsx)(n.p,{children:"Contains:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ContentType"})," (str): MIME type"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ContentLength"})," (int): File size in bytes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"LastModified"})," (datetime): Last modification time"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ETag"})," (str): Entity tag"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Metadata"})," (dict): Custom metadata"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Raises:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3NotFoundError"})," if file doesn't exist"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3Error"})," on other failures"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"bucket-operations",children:"Bucket Operations"}),"\n",(0,t.jsx)(n.h4,{id:"create_bucketbucketnone",children:(0,t.jsx)(n.code,{children:"create_bucket(bucket=None)"})}),"\n",(0,t.jsx)(n.p,{children:"Create an S3 bucket."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name (defaults to ",(0,t.jsx)(n.code,{children:"S3_BUCKET_NAME"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"bool"})," - True if created or already exists"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Raises:"})," ",(0,t.jsx)(n.code,{children:"S3Error"})," if creation fails"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"bucket_existsbucketnone",children:(0,t.jsx)(n.code,{children:"bucket_exists(bucket=None)"})}),"\n",(0,t.jsx)(n.p,{children:"Check if a bucket exists and is accessible."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bucket"})," (str, optional): Bucket name"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"bool"})," - True if bucket exists"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Raises:"})," ",(0,t.jsx)(n.code,{children:"S3PermissionError"})," if access is denied"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"list_buckets",children:(0,t.jsx)(n.code,{children:"list_buckets()"})}),"\n",(0,t.jsx)(n.p,{children:"List all buckets in the account."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"List[Dict]"})," - List of bucket metadata"]}),"\n",(0,t.jsx)(n.p,{children:"Each dictionary contains:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Name"})," (str): Bucket name"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"CreationDate"})," (datetime): Creation time"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"client-management",children:"Client Management"}),"\n",(0,t.jsx)(n.h4,{id:"get_client",children:(0,t.jsx)(n.code,{children:"get_client()"})}),"\n",(0,t.jsx)(n.p,{children:"Get or create the S3 client singleton."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"boto3.client"})," - Configured S3 client"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Raises:"})," ",(0,t.jsx)(n.code,{children:"S3ConfigError"})," if configuration is missing"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"reset_client",children:(0,t.jsx)(n.code,{children:"reset_client()"})}),"\n",(0,t.jsx)(n.p,{children:"Reset the S3 client singleton. Useful for testing or credential refresh."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"get_config",children:(0,t.jsx)(n.code,{children:"get_config()"})}),"\n",(0,t.jsx)(n.p,{children:"Get current S3 configuration (with masked secrets)."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"Dict"})," - Configuration dictionary"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"exception-handling",children:"Exception Handling"}),"\n",(0,t.jsx)(n.p,{children:"The component provides custom exceptions for better error handling:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from rakam_systems_tools.utils import s3\n\ntry:\n    content = s3.download_file("missing-file.txt")\nexcept s3.S3NotFoundError:\n    print("File not found")\nexcept s3.S3PermissionError:\n    print("Access denied")\nexcept s3.S3ConfigError:\n    print("Configuration error")\nexcept s3.S3Error as e:\n    print(f"General S3 error: {e}")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"exception-hierarchy",children:"Exception Hierarchy"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3Error"})," - Base exception for all S3 operations","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3ConfigError"})," - Configuration is invalid or missing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3NotFoundError"})," - Requested object not found"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3PermissionError"})," - Access denied"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"advanced-examples",children:"Advanced Examples"}),"\n",(0,t.jsx)(n.h3,{id:"working-with-binary-files",children:"Working with Binary Files"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Upload binary file\nwith open("image.jpg", "rb") as f:\n    image_data = f.read()\n\ns3.upload_file(\n    key="images/photo.jpg",\n    content=image_data,\n    content_type="image/jpeg"\n)\n\n# Download binary file\nimage_data = s3.download_file("images/photo.jpg", as_bytes=True)\nwith open("downloaded.jpg", "wb") as f:\n    f.write(image_data)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"using-custom-metadata",children:"Using Custom Metadata"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from datetime import datetime\n\n# Upload with metadata\ns3.upload_file(\n    key="reports/monthly.pdf",\n    content=pdf_data,\n    content_type="application/pdf",\n    metadata={\n        "author": "John Doe",\n        "created": datetime.now().isoformat(),\n        "version": "1.0"\n    }\n)\n\n# Retrieve metadata\nmetadata = s3.get_file_metadata("reports/monthly.pdf")\nprint(f"Author: {metadata[\'Metadata\'][\'author\']}")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"batch-operations",children:"Batch Operations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Upload multiple files\nfiles_to_upload = [\n    ("data/file1.txt", "Content 1"),\n    ("data/file2.txt", "Content 2"),\n    ("data/file3.txt", "Content 3"),\n]\n\nfor key, content in files_to_upload:\n    try:\n        s3.upload_file(key, content)\n        print(f"\u2705 Uploaded {key}")\n    except s3.S3Error as e:\n        print(f"\u274c Failed to upload {key}: {e}")\n\n# Delete multiple files\nfiles = s3.list_files(prefix="data/")\nfor file in files:\n    s3.delete_file(file[\'Key\'])\n'})}),"\n",(0,t.jsx)(n.h3,{id:"working-with-different-buckets",children:"Working with Different Buckets"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Upload to specific bucket\ns3.upload_file(\n    key="file.txt",\n    content="Hello",\n    bucket="my-other-bucket"\n)\n\n# List files in specific bucket\nfiles = s3.list_files(prefix="", bucket="my-other-bucket")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(n.p,{children:"Run the full S3 operations example (from the repository root):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python examples/s3_examples/s3_operations_example.py\n"})}),"\n",(0,t.jsx)(n.p,{children:"Clean up test files created by the example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python examples/s3_examples/s3_operations_example.py --cleanup\n"})}),"\n",(0,t.jsx)(n.h2,{id:"comparison-with-original-script",children:"Comparison with Original Script"}),"\n",(0,t.jsx)(n.h3,{id:"original-script-boto3-direct-usage",children:"Original Script (boto3 direct usage)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import boto3\nfrom botocore.exceptions import ClientError\n\ns3_client = boto3.client(\n    's3',\n    aws_access_key_id=S3_ACCESS_KEY,\n    aws_secret_access_key=S3_SECRET_KEY,\n    endpoint_url=S3_ENDPOINT_URL,\n    region_name=S3_REGION\n)\n\ntry:\n    s3_client.put_object(\n        Bucket=S3_BUCKET_NAME,\n        Key=file_key,\n        Body=content.encode('utf-8'),\n        ContentType='text/plain'\n    )\nexcept ClientError as e:\n    print(f\"Error: {e}\")\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rs-component-style-clean-and-simple",children:"RS Component Style (clean and simple)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from rakam_systems_tools.utils import s3\n\ntry:\n    s3.upload_file(file_key, content)\nexcept s3.S3Error as e:\n    print(f"Error: {e}")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use environment variables"})," for configuration (never hardcode credentials)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle exceptions"})," appropriately for your use case"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use prefixes"}),' to organize files in folders (e.g., "documents/2024/")']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Set appropriate content types"})," for better browser handling"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add metadata"})," for tracking and auditing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Clean up test files"})," after development/testing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Use ",(0,t.jsx)(n.code,{children:"as_bytes=True"})]})," when working with binary files"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"configuration-errors",children:"Configuration Errors"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"S3ConfigError: Missing required environment variables: S3_ACCESS_KEY, S3_SECRET_KEY\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," Ensure all required environment variables are set in your ",(0,t.jsx)(n.code,{children:".env"})," file."]}),"\n",(0,t.jsx)(n.h3,{id:"connection-errors",children:"Connection Errors"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"S3Error: Failed to upload file 'test.txt': EndpointConnectionError\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," Check that ",(0,t.jsx)(n.code,{children:"S3_ENDPOINT_URL"})," is correct for your S3-compatible service."]}),"\n",(0,t.jsx)(n.h3,{id:"permission-errors",children:"Permission Errors"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"S3PermissionError: Access denied to bucket 'my-bucket'\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," Verify your credentials have the necessary permissions for the bucket."]}),"\n",(0,t.jsx)(n.h3,{id:"bucket-name-errors",children:"Bucket Name Errors"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"S3Error: Invalid bucket name\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," Bucket names must:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Be 3-63 characters long"}),"\n",(0,t.jsx)(n.li,{children:"Contain only lowercase letters, numbers, and hyphens"}),"\n",(0,t.jsx)(n.li,{children:"Start and end with a letter or number"}),"\n",(0,t.jsx)(n.li,{children:"NOT contain underscores or uppercase letters"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"contributing",children:"Contributing"}),"\n",(0,t.jsx)(n.p,{children:"When extending the S3 component:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Follow the RS component pattern (see ",(0,t.jsx)(n.code,{children:"logging.py"})," as reference)"]}),"\n",(0,t.jsx)(n.li,{children:"Add proper type hints"}),"\n",(0,t.jsx)(n.li,{children:"Include docstrings with examples"}),"\n",(0,t.jsx)(n.li,{children:"Add custom exceptions for specific error cases"}),"\n",(0,t.jsx)(n.li,{children:"Update this documentation"}),"\n",(0,t.jsxs)(n.li,{children:["Add tests to ",(0,t.jsx)(n.code,{children:"test_s3_component.py"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,t.jsx)(n.p,{children:"Part of the Rakam Systems Core library."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>o});var i=s(6540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);